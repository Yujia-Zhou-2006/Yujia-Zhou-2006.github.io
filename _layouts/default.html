<!doctype html>
<html lang="en" data-color-mode="auto">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>{{ page.title | default: site.title }}</title>
  <meta name="color-scheme" content="light dark">
  <meta name="theme-color" content="#f6f8fa" id="theme-color-meta">
  
  <!-- 防止主题切换闪烁 - 必须在CSS加载前执行 -->
  <script>
    (function() {
      const KEY = 'colorMode';
      const saved = localStorage.getItem(KEY) || 'auto';
      let mode = saved;
      const LIGHT_COLOR = '#f6f8fa';
      const DARK_COLOR = '#0d1116';
      
      if (mode === 'auto') {
        const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
        mode = prefersDark ? 'dark' : 'light';
      }
      
      document.documentElement.setAttribute('data-color-mode', mode);
      const themeMeta = document.querySelector('meta[name="theme-color"]');
      if (themeMeta) {
        themeMeta.setAttribute('content', mode === 'dark' ? DARK_COLOR : LIGHT_COLOR);
      }
      const colorSchemeMeta = document.querySelector('meta[name="color-scheme"]');
      if (colorSchemeMeta) {
        colorSchemeMeta.setAttribute('content', mode === 'dark' ? 'dark light' : 'light dark');
      }
    })();
  </script>
  
  <link rel="stylesheet" href="https://unpkg.com/@primer/css@^21/dist/primer.css">
  <link rel="stylesheet" href="{{ '/assets/styles/theme-tokens.css' | relative_url }}">
</head>
<body>
  {% include header.html %}
  <main class="container-xl px-3 my-4 my-md-6">
    {{ content }}
  </main>
  {% include footer.html %}
  <script src="{{ '/assets/scripts/theme-toggle.js' | relative_url }}"></script>
  <script src="{{ '/assets/scripts/copy-wechat.js' | relative_url }}"></script>
</body>
</html>
